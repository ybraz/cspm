<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Framework Interativo para Remedia√ß√£o de CSPM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: A tabbed single-page application (SPA) was chosen to deconstruct the complex, multi-faceted topic of CSPM remediation into manageable, thematic sections. This structure avoids overwhelming the user with a long, scrolling document. The flow is designed to guide the user from foundational concepts (Strategies) to advanced implementation details (Pipeline, Metrics), mirroring a typical maturity journey. Key interactions include dynamic charts to visualize trade-offs, an interactive decision matrix to apply context, and toggleable content to explore specific patterns, making abstract concepts tangible and explorable. This user-centric design prioritizes clarity and guided learning over a literal representation of the source Q&A. -->
    <!-- Visualization & Content Choices: 
    - Remediation Strategies: Goal: Compare approaches. Viz: 3-column layout for direct comparison and a Bar Chart (Chart.js) to visualize the abstract trade-off between speed and safety. Interaction: Buttons to toggle chart view. Justification: Makes the core dilemma immediately understandable.
    - Organizational Context: Goal: Demonstrate context-based decision making. Viz: Interactive HTML matrix. Interaction: Dropdown filters change matrix content. Justification: Transforms a complex decision tree into a simple, interactive tool.
    - Pipeline vs. Policy: Goal: Illustrate the IaC drift problem and solution. Viz: 'Before/After' diagrams using HTML/Tailwind. Interaction: Toggles for exploring patterns. Justification: Visual storytelling is more effective than text for process-related problems.
    - Metrics & Validation: Goal: Show how to measure success. Viz: Stat cards and a Line Chart (Chart.js). Interaction: Buttons to switch metrics on the chart. Justification: A dashboard-like view familiar to the target audience for tracking KPIs.
    - All visualizations use Canvas via Chart.js or are constructed with HTML/CSS, adhering to the requirements.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8; /* Warm beige background */
            color: #38342F; /* Dark brown-gray text */
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            border-bottom-color: #D5A021; /* Muted gold accent */
            color: #38342F;
        }
        .tab-button:not(.active) {
            color: #7B7368; /* Lighter brown-gray for inactive tabs */
        }
        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            border: 1px solid #EFEBE6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 40vh;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        .decision-matrix td {
            transition: background-color 0.3s ease;
        }
        .gemini-output {
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .gemini-output pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .gemini-output code {
            font-family: 'Courier New', Courier, monospace;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Framework Interativo para Remedia√ß√£o de CSPM</h1>
            <p class="mt-2 text-lg text-gray-600 max-w-3xl mx-auto">Equilibrando Seguran√ßa e Disponibilidade em Ambientes de Produ√ß√£o</p>
        </header>

        <div class="card p-4 mb-8">
            <nav id="tabs" class="flex flex-wrap justify-center items-center gap-4 md:gap-8 border-b border-gray-200">
                <button data-tab="strategies" class="tab-button active py-3 px-2 text-sm md:text-base font-semibold">Estrat√©gias</button>
                <button data-tab="context" class="tab-button py-3 px-2 text-sm md:text-base font-semibold">Contexto</button>
                <button data-tab="pipeline" class="tab-button py-3 px-2 text-sm md:text-base font-semibold">Pipeline</button>
                <button data-tab="metrics" class="tab-button py-3 px-2 text-sm md:text-base font-semibold">M√©tricas</button>
                <button data-tab="research" class="tab-button py-3 px-2 text-sm md:text-base font-semibold">Pesquisa ‚ú®</button>
            </nav>
        </div>

        <main id="tab-content">
            <div id="strategies-content" class="tab-panel space-y-8">
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Quando e Como Remediar?</h2>
                    <p class="text-gray-600 mb-6">A escolha do tipo de controle √© um trade-off fundamental. Controles preventivos oferecem a maior seguran√ßa, mas podem impactar a agilidade. Controles detectivos com auto-remedia√ß√£o equilibram velocidade e seguran√ßa, enquanto a cria√ß√£o de tickets √© a op√ß√£o mais segura para a disponibilidade, mas a mais lenta para a remedia√ß√£o.</p>
                    <div class="grid md:grid-cols-3 gap-6 text-center">
                        <div class="border border-gray-200 rounded-lg p-6">
                             <div class="text-4xl mb-2">üõ°Ô∏è</div>
                             <h3 class="font-bold text-lg mb-2">Controles Preventivos</h3>
                             <p class="text-sm text-gray-600"><strong>Exemplo:</strong> AWS SCPs, Azure Policy (deny).<br><strong>Ideal para:</strong> Viola√ß√µes de alto risco, inegoci√°veis (ex: S3 buckets p√∫blicos, portas de gerenciamento abertas para 0.0.0.0).<br><strong>Vantagem:</strong> Impede a m√° configura√ß√£o de acontecer.</p>
                        </div>
                        <div class="border border-blue-200 bg-blue-50 rounded-lg p-6 ring-2 ring-blue-300">
                            <div class="text-4xl mb-2">ü§ñ</div>
                            <h3 class="font-bold text-lg mb-2">Detectivo + Auto-Remedia√ß√£o</h3>
                            <p class="text-sm text-gray-600"><strong>Exemplo:</strong> Lambda/Function que remove regra de firewall insegura.<br><strong>Ideal para:</strong> Riscos conhecidos e com caminho de remedia√ß√£o seguro e testado (ex: desabilitar acesso p√∫blico a snapshots de DB).<br><strong>Vantagem:</strong> Resposta r√°pida a desvios de postura.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-6">
                            <div class="text-4xl mb-2">üéüÔ∏è</div>
                            <h3 class="font-bold text-lg mb-2">Detectivo + Ticket/Aprova√ß√£o</h3>
                            <p class="text-sm text-gray-600"><strong>Exemplo:</strong> Alerta no PagerDuty para time de SRE.<br><strong>Ideal para:</strong> Configura√ß√µes complexas, sens√≠veis ou com alto risco de impacto na disponibilidade se a remedia√ß√£o for incorreta (ex: altera√ß√£o em regras de rede de um sistema cr√≠tico).<br><strong>Vantagem:</strong> An√°lise humana previne indisponibilidade.</p>
                        </div>
                    </div>
                </div>

                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Visualizando o Trade-Off</h2>
                    <p class="text-gray-600 mb-6">A efic√°cia de uma estrat√©gia de remedia√ß√£o pode ser vista como um balan√ßo entre a velocidade da corre√ß√£o de seguran√ßa e o risco para a disponibilidade do servi√ßo. Interaja com o gr√°fico para ver como cada abordagem se posiciona.</p>
                    <div class="chart-container">
                        <canvas id="tradeoffChart"></canvas>
                    </div>
                </div>
                
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Padr√µes de Rollout de Pol√≠ticas (Enforcement)</h2>
                    <p class="text-gray-600 mb-6">Antes de aplicar uma pol√≠tica de remedia√ß√£o globalmente, organiza√ß√µes maduras utilizam padr√µes de rollout faseado para minimizar o risco de indisponibilidade em larga escala. Essa abordagem permite validar o impacto da remedia√ß√£o de forma controlada.</p>
                    <div class="relative pl-8 border-l-2 border-gray-200 space-y-10">
                        <div class="absolute w-4 h-4 bg-yellow-400 rounded-full -left-2 top-1 border-4 border-white"></div>
                        <div>
                            <h3 class="font-bold text-lg">Fase 1: Per√≠odo de Car√™ncia (Grace Period)</h3>
                            <p class="text-gray-600 mt-1">Recursos n√£o conformes s√£o apenas notificados, sem a√ß√£o de remedia√ß√£o. Isso d√° tempo aos times de engenharia para se adaptarem √† nova pol√≠tica e corrigirem suas configura√ß√µes proativamente via IaC, antes que o enforcement autom√°tico comece.</p>
                        </div>
                        <div class="absolute w-4 h-4 bg-orange-400 rounded-full -left-2 top-1/2 -translate-y-1/2 border-4 border-white"></div>
                        <div>
                            <h3 class="font-bold text-lg">Fase 2: Remedia√ß√£o Can√°rio (Canary Remediation)</h3>
                            <p class="text-gray-600 mt-1">A auto-remedia√ß√£o √© ativada apenas para um escopo limitado e de baixo risco (ex: contas de desenvolvimento, um workload n√£o cr√≠tico). M√©tricas de disponibilidade e falhas s√£o monitoradas de perto para validar a seguran√ßa da automa√ß√£o.</p>
                        </div>
                        <div class="absolute w-4 h-4 bg-green-500 rounded-full -left-2 bottom-1 border-4 border-white"></div>
                        <div>
                            <h3 class="font-bold text-lg">Fase 3: Enforcement Global</h3>
                            <p class="text-gray-600 mt-1">Ap√≥s valida√ß√£o nas fases anteriores, a pol√≠tica de auto-remedia√ß√£o √© aplicada a todos os ambientes, incluindo produ√ß√£o. A automa√ß√£o agora atua como uma salvaguarda constante para a postura de seguran√ßa da nuvem.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="context-content" class="tab-panel hidden space-y-8">
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Matriz de Decis√£o de Remedia√ß√£o</h2>
                    <p class="text-gray-600 mb-6">A decis√£o de remediar automaticamente n√£o deve ser bin√°ria. Ela depende do contexto do neg√≥cio. Fatores como a criticidade do sistema, a sensibilidade dos dados e as obriga√ß√µes regulat√≥rias devem modular a abordagem. Use o seletor abaixo para ver como diferentes contextos regulat√≥rios podem alterar a estrat√©gia de remedia√ß√£o recomendada.</p>
                    
                    <div class="mb-6">
                        <label for="compliance-filter" class="block text-sm font-medium text-gray-700 mb-1">Contexto Regulat√≥rio:</label>
                        <select id="compliance-filter" class="w-full md:w-1/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <option value="none" selected>Nenhum (Padr√£o)</option>
                            <option value="lgpd">LGPD (Dados Pessoais)</option>
                            <option value="pci">PCI-DSS (Cart√£o de Cr√©dito)</option>
                        </select>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse text-sm text-center decision-matrix">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="p-3 font-semibold border" rowspan="2" id="matrix-asset-criticality">Criticidade do Ativo</th>
                                    <th class="p-3 font-semibold border" colspan="3" id="matrix-data-sensitivity">Sensibilidade dos Dados</th>
                                </tr>
                                <tr class="bg-gray-50">
                                    <th class="p-3 font-semibold border">P√∫blico</th>
                                    <th class="p-3 font-semibold border">Interno</th>
                                    <th class="p-3 font-semibold border">Confidencial / Regulado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-3 font-semibold border">Tier 3 (Baixa)</td>
                                    <td data-row="low" data-col="public" class="p-3 border">Auto-Remedia√ß√£o</td>
                                    <td data-row="low" data-col="internal" class="p-3 border">Auto-Remedia√ß√£o</td>
                                    <td data-row="low" data-col="confidential" class="p-3 border">Auto-Remedia√ß√£o</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-semibold border">Tier 2 (M√©dia)</td>
                                    <td data-row="medium" data-col="public" class="p-3 border">Auto-Remedia√ß√£o</td>
                                    <td data-row="medium" data-col="internal" class="p-3 border">Ticket com SLA Curto</td>
                                    <td data-row="medium" data-col="confidential" class="p-3 border">Ticket com SLA Curto</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-semibold border">Tier 1 (Cr√≠tico)</td>
                                    <td data-row="high" data-col="public" class="p-3 border">Ticket com SLA Curto</td>
                                    <td data-row="high" data-col="internal" class="p-3 border">Ticket com Aprova√ß√£o</td>
                                    <td data-row="high" data-col="confidential" class="p-3 border">Ticket com Aprova√ß√£o</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                     <div class="mt-6 text-center">
                        <button id="explainRiskBtn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">‚ú® Explicar Risco e Estrat√©gia</button>
                    </div>
                    <div id="riskExplanationOutput" class="gemini-output hidden"></div>
                </div>
            </div>

            <div id="pipeline-content" class="tab-panel hidden space-y-8">
                <div class="card p-6 md:p-8">
                     <h2 class="text-2xl font-bold mb-2">Resolvendo o Conflito "Pipeline vs. Pol√≠tica"</h2>
                    <p class="text-gray-600 mb-6">Um desafio comum √© o "drift" de IaC. Uma remedia√ß√£o autom√°tica corrige um recurso na nuvem, mas na pr√≥xima execu√ß√£o do pipeline de CI/CD, o c√≥digo-fonte (ex: Terraform) que ainda cont√©m a m√° configura√ß√£o √© reaplicado, desfazendo a corre√ß√£o e causando um ciclo de conflito que pode levar √† indisponibilidade.</p>

                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <div>
                            <h3 class="font-bold text-lg text-red-600 mb-2">‚ùå Abordagem Problem√°tica: Remedia√ß√£o Cega</h3>
                            <div class="text-sm border-l-4 border-red-500 pl-4 py-2 bg-red-50">
                                <p><strong>1. Pipeline:</strong> Deploy de bucket S3 p√∫blico via Terraform.</p>
                                <p><strong>2. CSPM:</strong> Detecta e auto-remedia, tornando o bucket privado.</p>
                                <p><strong>3. Conflito:</strong> Aplica√ß√£o quebra por n√£o acessar o bucket.</p>
                                <p><strong>4. Pr√≥ximo Deploy:</strong> Pipeline reaplica o Terraform, bucket volta a ser p√∫blico.</p>
                                <p class="font-semibold mt-2">Resultado: Loop de corre√ß√£o e quebra.</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-green-600 mb-2">‚úÖ Padr√£o Recomendado: Remedia√ß√£o Ciente do Pipeline</h3>
                             <div class="text-sm border-l-4 border-green-500 pl-4 py-2 bg-green-50">
                                <p><strong>1. CSPM:</strong> Detecta bucket p√∫blico.</p>
                                <p><strong>2. A√ß√£o:</strong> Em vez de alterar o recurso, uma automa√ß√£o abre um Pull Request (PR) no reposit√≥rio Git com a corre√ß√£o no c√≥digo Terraform.</p>
                                <p><strong>3. Pipeline:</strong> O PR passa por testes e aprova√ß√£o humana.</p>
                                <p><strong>4. Deploy:</strong> O pipeline aplica a corre√ß√£o de forma segura e persistente.</p>
                                <p class="font-semibold mt-2">Resultado: Fonte da verdade √© corrigida, evitando drift.</p>
                            </div>
                            <div class="mt-4 text-left">
                                <button id="generateFixBtn" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">‚ú® Gerar Sugest√£o de Corre√ß√£o (IaC)</button>
                            </div>
                        </div>
                    </div>
                     <div id="iacFixOutput" class="gemini-output hidden"></div>
                </div>
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Gest√£o de Exce√ß√µes e Policy-as-Code</h2>
                    <p class="text-gray-600 mb-6">Uma estrat√©gia de enforcement realista requer um processo formal para gerenciar exce√ß√µes e a integra√ß√£o de checagens de pol√≠tica o mais cedo poss√≠vel no ciclo de vida de desenvolvimento ("shift-left").</p>
                    <div class="space-y-4">
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold">üìú Gest√£o de Exce√ß√µes (Waivers)</h3>
                            <p class="text-sm text-gray-600 mt-1">Exce√ß√µes devem ser raras, documentadas e com tempo de vida limitado (TTL). Padr√µes comuns incluem o uso de tags espec√≠ficas (ex: `security-waiver-exp=2025-12-31`) que a automa√ß√£o de CSPM pode ignorar temporariamente.</p>
                        </div>
                        <div class="border rounded-lg p-4">
                            <h3 class="font-semibold">üö¶ Policy-as-Code (PaC)</h3>
                            <p class="text-sm text-gray-600 mt-1">Integrar ferramentas como OPA, Checkov ou tfsec no pipeline de CI/CD. Essas ferramentas analisam o c√≥digo IaC em busca de n√£o conformidades antes do merge do PR (pr√©-merge checks), impedindo que a m√° configura√ß√£o chegue √† produ√ß√£o. Isso transforma a seguran√ßa de um gate reativo para um feedback proativo ao desenvolvedor.</p>
                        </div>
                         <div class="border rounded-lg p-4">
                            <h3 class="font-semibold">üö® Kill Switches / Feature Flags</h3>
                            <p class="text-sm text-gray-600 mt-1">Toda automa√ß√£o de remedia√ß√£o cr√≠tica deve ter um "kill switch" ‚Äì um mecanismo de emerg√™ncia para desabilit√°-la rapidamente em caso de comportamento inesperado que cause indisponibilidade generalizada. Isso pode ser implementado via feature flags ou vari√°veis de configura√ß√£o.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="metrics-content" class="tab-panel hidden space-y-8">
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Medindo a Efic√°cia</h2>
                    <p class="text-gray-600 mb-6">A efic√°cia de uma estrat√©gia de remedia√ß√£o √© demonstrada por um conjunto de m√©tricas de resultado, n√£o apenas de atividade. O objetivo √© provar que a seguran√ßa est√° melhorando sem degradar a estabilidade e a velocidade da engenharia.</p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-3xl font-bold text-blue-600" id="mttr-value"></div>
                            <p class="text-sm font-medium text-gray-600">MTTR de Misconfigurations (horas)</p>
                        </div>
                         <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-3xl font-bold text-green-600" id="drift-value"></div>
                            <p class="text-sm font-medium text-gray-600">% de Drift (IaC vs. Realidade)</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-3xl font-bold text-red-600" id="failure-rate-value"></div>
                            <p class="text-sm font-medium text-gray-600">Change Failure Rate (%)</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-3xl font-bold text-orange-600" id="outage-value"></div>
                            <p class="text-sm font-medium text-gray-600">Incidentes de Indisponibilidade por Remedia√ß√£o</p>
                        </div>
                    </div>
                </div>

                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Evolu√ß√£o das M√©tricas ao Longo do Tempo</h2>
                    <p class="text-gray-600 mb-6">√Ä medida que a estrat√©gia de remedia√ß√£o amadurece, espera-se que o tempo para remediar (MTTR) caia drasticamente, enquanto m√©tricas de estabilidade, como a taxa de falha de mudan√ßas, permane√ßam baixas, indicando que a automa√ß√£o √© segura.</p>
                    <div class="chart-container">
                        <canvas id="metricsChart"></canvas>
                    </div>
                    <div class="text-center mt-4">
                        <button id="updateMetricsBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Simular Evolu√ß√£o</button>
                    </div>
                </div>
                
                 <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">Valida√ß√£o Emp√≠rica</h2>
                    <p class="text-gray-600 mb-6">Antes de um rollout global, como validar que uma nova regra de auto-remedia√ß√£o √© segura? A experimenta√ß√£o controlada √© a chave. Use feature toggles para ativar a remedia√ß√£o para uma pequena porcentagem do tr√°fego ou para um conjunto espec√≠fico de recursos. Monitore de perto as m√©tricas de neg√≥cio e operacionais (SLOs, lat√™ncia, erros) desse grupo de controle em compara√ß√£o com a linha de base. Se n√£o houver degrada√ß√£o, a confian√ßa para expandir o rollout aumenta.</p>
                 </div>
            </div>
            
            <div id="research-content" class="tab-panel hidden space-y-8">
                <div class="card p-6 md:p-8">
                    <h2 class="text-2xl font-bold mb-2">‚ú® Pesquisa e Benchmarks com IA</h2>
                    <p class="text-gray-600 mb-6">Mantenha-se atualizado com as √∫ltimas tend√™ncias, pesquisas e benchmarks da ind√∫stria. Fa√ßa uma pergunta sobre remedia√ß√£o de CSPM, CNAPP ou automa√ß√£o de seguran√ßa, e a IA usar√° a busca do Google para encontrar as informa√ß√µes mais recentes e relevantes para voc√™.</p>
                    
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="researchQueryInput" class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Ex: quais s√£o os benchmarks de MTTR para misconfigurations?">
                        <button id="researchQueryBtn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors w-full sm:w-auto">Pesquisar</button>
                    </div>
                    
                    <div id="researchQueryOutput" class="gemini-output hidden"></div>
                </div>
            </div>

        </main>
        <div id="loader" class="loader hidden"></div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tabs = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');
    const loader = document.getElementById('loader');

    // Tab navigation logic
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            const targetTab = tab.getAttribute('data-tab');
            tabPanels.forEach(panel => {
                panel.id === `${targetTab}-content` ? panel.classList.remove('hidden') : panel.classList.add('hidden');
            });
        });
    });

    // Gemini API call function with exponential backoff
    async function callGeminiAPI(prompt, useGrounding = false, maxRetries = 3) {
        loader.classList.remove('hidden');
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
        };

        if (useGrounding) {
            payload.tools = [{ "google_search": {} }];
        }

        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let sources = [];
                    if (useGrounding) {
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attr => ({ uri: attr.web?.uri, title: attr.web?.title }))
                                .filter(source => source.uri && source.title);
                        }
                    }
                    loader.classList.add('hidden');
                    return { text: candidate.content.parts[0].text, sources };
                } else {
                    throw new Error('Invalid response structure from Gemini API');
                }
            } catch (error) {
                console.error(`Attempt ${i + 1} failed:`, error);
                if (i === maxRetries - 1) {
                    loader.classList.add('hidden');
                    return { text: "Desculpe, ocorreu um erro ao contatar a IA. Por favor, tente novamente mais tarde.", sources: [] };
                }
                await new Promise(res => setTimeout(res, Math.pow(2, i) * 1000));
            }
        }
    }

    // IaC Fix Generation
    const generateFixBtn = document.getElementById('generateFixBtn');
    const iacFixOutput = document.getElementById('iacFixOutput');
    generateFixBtn.addEventListener('click', async () => {
        iacFixOutput.classList.remove('hidden');
        iacFixOutput.innerHTML = '';
        const prompt = `Como um especialista em seguran√ßa em nuvem e DevOps, gere um snippet de c√≥digo Terraform HCL para corrigir um recurso 'aws_s3_bucket' que est√° configurado como p√∫blico. Mostre o 'antes' e o 'depois'. O 'antes' deve ter 'acl = "public-read"'. O 'depois' deve usar um recurso 'aws_s3_bucket_public_access_block' para garantir que o bucket seja privado. Formate a sa√≠da como blocos de c√≥digo HCL dentro de markdown.`;
        const { text } = await callGeminiAPI(prompt);
        iacFixOutput.innerHTML = `<pre><code class="language-hcl">${text.replace(/```hcl\n|```/g, '').trim()}</code></pre>`;
    });

    // Risk Explanation Generation
    const explainRiskBtn = document.getElementById('explainRiskBtn');
    const riskExplanationOutput = document.getElementById('riskExplanationOutput');
    const complianceFilter = document.getElementById('compliance-filter');
    explainRiskBtn.addEventListener('click', async () => {
        riskExplanationOutput.classList.remove('hidden');
        riskExplanationOutput.innerHTML = '';

        const selectedCompliance = complianceFilter.options[complianceFilter.selectedIndex].text;
        const matrixHeaders = Array.from(document.querySelectorAll('.decision-matrix th'));
        const matrixCells = Array.from(document.querySelectorAll('.decision-matrix td[data-row]'));

        // This is a simplified way to get the context. A real app might have users click a cell.
        // For this demo, we'll pick a representative scenario.
        const criticality = "Tier 1 (Cr√≠tico)";
        const sensitivity = "Confidencial / Regulado";
        const strategy = "Ticket com Aprova√ß√£o";
        
        const prompt = `Explique em um par√°grafo conciso o risco de neg√≥cio e a justificativa para a estrat√©gia de remedia√ß√£o, considerando o seguinte contexto:\n- Criticidade do Ativo: ${criticality}\n- Sensibilidade dos Dados: ${sensitivity}\n- Framework Regulat√≥rio: ${selectedCompliance}\n- Estrat√©gia de Remedia√ß√£o Recomendada: ${strategy}\n\nA resposta deve ser clara, direta e focada no impacto para o neg√≥cio.`;
        
        const { text } = await callGeminiAPI(prompt);
        riskExplanationOutput.textContent = text;
    });

    // Research Query
    const researchQueryBtn = document.getElementById('researchQueryBtn');
    const researchQueryInput = document.getElementById('researchQueryInput');
    const researchQueryOutput = document.getElementById('researchQueryOutput');
    researchQueryBtn.addEventListener('click', async () => {
        const query = researchQueryInput.value;
        if (!query) {
            alert('Por favor, insira uma pergunta.');
            return;
        }
        researchQueryOutput.classList.remove('hidden');
        researchQueryOutput.innerHTML = '';
        const prompt = `Atuando como um analista de ciberseguran√ßa, responda √† seguinte pergunta sobre CSPM e seguran√ßa em nuvem, usando informa√ß√µes atualizadas da web: "${query}"`;
        
        const { text, sources } = await callGeminiAPI(prompt, true);
        
        let sourcesHtml = '';
        if (sources.length > 0) {
            sourcesHtml = '<h4 class="font-semibold mt-4 mb-2">Fontes:</h4><ul class="list-disc pl-5 text-sm">';
            sources.forEach(source => {
                sourcesHtml += `<li><a href="${source.uri}" target="_blank" class="text-blue-600 hover:underline">${source.title}</a></li>`;
            });
            sourcesHtml += '</ul>';
        }

        researchQueryOutput.innerHTML = `<p>${text}</p>${sourcesHtml}`;
    });
    
    // Charts and initial setup code (from previous version)
    const ctxTradeoff = document.getElementById('tradeoffChart').getContext('2d');
    new Chart(ctxTradeoff, {
        type: 'bar',
        data: {
            labels: ['Preventivo', 'Auto-Remedia√ß√£o', 'Ticket/Manual'],
            datasets: [{
                label: 'Velocidade de Remedia√ß√£o',
                data: [100, 80, 20],
                backgroundColor: 'rgba(59, 130, 246, 0.7)',
            }, {
                label: 'Seguran√ßa da Disponibilidade',
                data: [60, 85, 100],
                backgroundColor: 'rgba(16, 185, 129, 0.7)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, max: 110, ticks: { callback: (v) => v + '%' }}},
            plugins: { title: { display: true, text: 'Trade-off: Velocidade vs. Seguran√ßa da Disponibilidade' }}
        }
    });

    const matrixCells = document.querySelectorAll('.decision-matrix td[data-row]');
    const decisionLogic = {
        none: { low: { public: 'Auto-Remedia√ß√£o', internal: 'Auto-Remedia√ß√£o', confidential: 'Auto-Remedia√ß√£o' }, medium: { public: 'Auto-Remedia√ß√£o', internal: 'Ticket SLA Curto', confidential: 'Ticket SLA Curto' }, high: { public: 'Ticket SLA Curto', internal: 'Ticket com Aprova√ß√£o', confidential: 'Ticket com Aprova√ß√£o' }},
        lgpd: { low: { public: 'Auto-Remedia√ß√£o', internal: 'Auto-Remedia√ß√£o', confidential: 'Auto-Remedia√ß√£o' }, medium: { public: 'Auto-Remedia√ß√£o', internal: 'Auto-Remedia√ß√£o', confidential: 'Ticket SLA Curto' }, high: { public: 'Ticket SLA Curto', internal: 'Ticket com Aprova√ß√£o', confidential: 'Auto-Remedia√ß√£o (Bloqueio)' }},
        pci: { low: { public: 'Auto-Remedia√ß√£o', internal: 'Auto-Remedia√ß√£o', confidential: 'Auto-Remedia√ß√£o' }, medium: { public: 'Auto-Remedia√ß√£o', internal: 'Auto-Remedia√ß√£o', confidential: 'Auto-Remedia√ß√£o (Bloqueio)' }, high: { public: 'Ticket com Aprova√ß√£o', internal: 'Auto-Remedia√ß√£o (Bloqueio)', confidential: 'Auto-Remedia√ß√£o (Bloqueio)' }}
    };
    const colors = { 'Auto-Remedia√ß√£o': 'bg-green-100 text-green-800', 'Auto-Remedia√ß√£o (Bloqueio)': 'bg-red-200 text-red-900 font-bold', 'Ticket SLA Curto': 'bg-yellow-100 text-yellow-800', 'Ticket com Aprova√ß√£o': 'bg-orange-100 text-orange-800' };
    function updateMatrix() {
        const logic = decisionLogic[complianceFilter.value];
        matrixCells.forEach(cell => {
            const text = logic[cell.dataset.row][cell.dataset.col];
            cell.textContent = text;
            cell.className = 'p-3 border ' + (colors[text] || '');
        });
    }
    complianceFilter.addEventListener('change', updateMatrix);
    updateMatrix();

    const mttrEl = document.getElementById('mttr-value'), driftEl = document.getElementById('drift-value'), failureRateEl = document.getElementById('failure-rate-value'), outageEl = document.getElementById('outage-value');
    let mttr = 48, drift = 15, failureRate = 3.5, outages = 5;
    function animateValue(el, start, end, duration) { let s=null; const step=(t)=>{ if(!s)s=t; const p=Math.min((t-s)/duration,1); const c=start+p*(end-start); el.innerHTML = el.id==='failure-rate-value'?c.toFixed(1):Math.floor(c); if(p<1)window.requestAnimationFrame(step);}; window.requestAnimationFrame(step); }
    animateValue(mttrEl, 0, mttr, 1000); animateValue(driftEl, 0, drift, 1000); animateValue(failureRateEl, 0, failureRate, 1000); animateValue(outageEl, 0, outages, 1000);

    const ctxMetrics = document.getElementById('metricsChart').getContext('2d');
    const metricsChart = new Chart(ctxMetrics, {
        type: 'line',
        data: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], datasets: [{ label: 'MTTR de Misconfigurations (h)', data: [48, 24, 8, 2], borderColor: 'rgba(59, 130, 246, 1)', backgroundColor: 'rgba(59, 130, 246, 0.2)', fill: true, tension: 0.3 }, { label: 'Incidentes por Remedia√ß√£o', data: [5, 4, 1, 0], borderColor: 'rgba(239, 68, 68, 1)', backgroundColor: 'rgba(239, 68, 68, 0.2)', fill: true, tension: 0.3 }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }}, plugins: { title: { display: true, text: 'Evolu√ß√£o das M√©tricas Chave' }}}
    });

    document.getElementById('updateMetricsBtn').addEventListener('click', () => {
        metricsChart.data.datasets.forEach(d => { d.data = d.data.map(v => Math.max(0, v * (0.6 + Math.random() * 0.3)).toFixed(1)); });
        metricsChart.update();
        let nMttr = mttr * 0.4, nDrift = drift * 0.5, nFail = failureRate * 0.8, nOut = outages * 0.2;
        animateValue(mttrEl, mttr, nMttr, 1000); animateValue(driftEl, drift, nDrift, 1000); animateValue(failureRateEl, failureRate, nFail, 1000); animateValue(outageEl, outages, nOut, 1000);
        mttr=nMttr; drift=nDrift; failureRate=nFail; outages=nOut;
    });
});
</script>
</body>
</html>
